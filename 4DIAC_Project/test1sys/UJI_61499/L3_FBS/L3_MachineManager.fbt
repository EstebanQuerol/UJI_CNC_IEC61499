<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE FBType SYSTEM "http://www.holobloc.com/xml/LibraryElement.dtd">
<FBType Comment="Composite Function Block Type" Name="L3_MachineManager">
  <Identification Standard="61499-2"/>
  <VersionInfo Author="EQUEROL" Date="2014-10-06" Organization="UJI" Version="0.0"/>
  <CompilerInfo/>
  <InterfaceList>
    <EventInputs>
      <Event Comment="Initialization Request" Name="INIT" Type="Event">
        <With Var="QI"/>
        <With Var="MType"/>
        <With Var="Period"/>
      </Event>
      <Event Comment="Request to handle a released machine" Name="REQ1" Type="Event">
        <With Var="MID1"/>
      </Event>
      <Event Comment="Request to handle a change in the operative state of a machine" Name="REQ2" Type="Event">
        <With Var="MID2"/>
        <With Var="State"/>
      </Event>
    </EventInputs>
    <EventOutputs>
      <Event Comment="Initialization Confirm" Name="INITO" Type="Event">
        <With Var="QO"/>
      </Event>
    </EventOutputs>
    <InputVars>
      <VarDeclaration Comment="Input event qualifier" Name="QI" Type="BOOL"/>
      <VarDeclaration Comment="MMCore execution period" InitialValue="T#1000ms" Name="Period" Type="TIME"/>
      <VarDeclaration ArraySize="15" Comment="Machine type vector" InitialValue="[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]" Name="MType" Type="USINT"/>
      <VarDeclaration Comment="Machine identifier" Name="MID1" Type="USINT"/>
      <VarDeclaration Comment="Machine identifier" Name="MID2" Type="USINT"/>
      <VarDeclaration Comment="Machine state, true =OK, FALSE=KO" Name="State" Type="BOOL"/>
    </InputVars>
    <OutputVars>
      <VarDeclaration Comment="Output event qualifier" Name="QO" Type="BOOL"/>
    </OutputVars>
    <Plugs>
      <AdapterDeclaration Name="L3_AAssignMachine" Type="L3_AAssignMachine" x="1330.0" y="665.0"/>
    </Plugs>
  </InterfaceList>
  <FBNetwork>
    <FB Name="L3_ReleasedMHDLR" Type="L3_ReleasedMHDLR" x="4845.0" y="95.0"/>
    <FB Name="L3_FaultyMHDLR" Type="L3_FaultyMHDLR" x="5035.0" y="1520.0"/>
    <FB Name="CORE_TIMEOUT" Type="E_DELAY" x="6385.0" y="880.0"/>
    <FB Name="L3_MMCore" Type="L3_MMCore" x="5380.0" y="905.0"/>
    <DataConnections>
      <Connection Destination="L3_ReleasedMHDLR.MID" Source="MID1" dx1="4395.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="L3_FaultyMHDLR.MID" Source="MID2" dx1="200.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="L3_FaultyMHDLR.State" Source="State" dx1="0.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="L3_AAssignMachine.MTypeP" Source="MType" dx1="895.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="L3_MMCore.QI" Source="QI" dx1="2410.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="L3_MMCore.MReleased" Source="L3_ReleasedMHDLR.MReleased" dx1="685.0" dx2="-305.0" dy="2215.0"/>
      <Connection Destination="L3_MMCore.MFaulty" Source="L3_FaultyMHDLR.MFaulty" dx1="490.0" dx2="-225.0" dy="960.0"/>
      <Connection Destination="L3_MMCore.MAssignS" Source="L3_AAssignMachine.MAssignS" dx1="345.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="L3_MMCore.MFinalAssignS" Source="L3_AAssignMachine.MFinalAssignS" dx1="180.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="QO" Source="L3_MMCore.QO" dx1="2450.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="L3_AAssignMachine.MStateP" Source="L3_MMCore.MStateP" dx1="330.0" dx2="-460.0" dy="870.0"/>
      <Connection Destination="L3_AAssignMachine.MPriorityP" Source="L3_MMCore.MPriority" dx1="250.0" dx2="-360.0" dy="720.0"/>
      <Connection Destination="L3_AAssignMachine.MAssignP" Source="L3_MMCore.MAssignP" dx1="175.0" dx2="-230.0" dy="570.0"/>
      <Connection Destination="L3_AAssignMachine.MFinalAssignP" Source="L3_MMCore.MFinalAssignP" dx1="125.0" dx2="-130.0" dy="405.0"/>
      <Connection Destination="CORE_TIMEOUT.DT" Source="Period" dx1="4185.0" dx2="0.0" dy="0.0"/>
    </DataConnections>
    <EventConnections>
      <Connection Destination="L3_ReleasedMHDLR.REQ1" Source="REQ1" dx1="2465.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="L3_FaultyMHDLR.REQ2" Source="REQ2" dx1="320.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="L3_MMCore.INIT" Source="INIT" dx1="2845.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="L3_MMCore.RSP1" Source="L3_ReleasedMHDLR.CNF" dx1="940.0" dx2="-525.0" dy="3060.0"/>
      <Connection Destination="L3_MMCore.RSP2" Source="L3_FaultyMHDLR.CNF" dx1="745.0" dx2="-440.0" dy="1855.0"/>
      <Connection Destination="L3_MMCore.RSP3" Source="L3_AAssignMachine.CNF1" dx1="225.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="L3_MMCore.RSP4" Source="L3_AAssignMachine.CNF2" dx1="155.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="INITO" Source="L3_MMCore.INITO" dx1="300.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="L3_ReleasedMHDLR.REQ2" Source="L3_MMCore.IND1" dx1="505.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="L3_FaultyMHDLR.REQ1" Source="L3_MMCore.IND2" dx1="610.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="L3_AAssignMachine.CHK" Source="L3_MMCore.IND3" dx1="500.0" dx2="-655.0" dy="1540.0"/>
      <Connection Destination="L3_AAssignMachine.ASG" Source="L3_MMCore.IND4" dx1="425.0" dx2="-545.0" dy="1380.0"/>
      <Connection Destination="CORE_TIMEOUT.START" Source="L3_MMCore.Start" dx1="800.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="CORE_TIMEOUT.STOP" Source="L3_MMCore.Stop" dx1="875.0" dx2="0.0" dy="0.0"/>
      <Connection Destination="L3_MMCore.TimeOut" Source="CORE_TIMEOUT.EO" dx1="610.0" dx2="-365.0" dy="2345.0"/>
    </EventConnections>
  </FBNetwork>
</FBType>
