<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE FBType SYSTEM "http://www.holobloc.com/xml/LibraryElement.dtd">
<FBType Comment="FAGOR 8070 CNC service FB" Name="L0_8070Service">
  <Identification Description="This FB is the entry point of the CNC service " Standard="61499-2"/>
  <VersionInfo Author="EQUEROL" Date="2014-09-01" Organization="UJI" Version="0.0"/>
  <InterfaceList>
    <EventInputs>
      <Event Comment="Initialization Request" Name="INIT" Type="Event">
        <With Var="QI"/>
      </Event>
      <Event Comment="Normal Execution Request" Name="REQ" Type="Event">
        <With Var="QI"/>
        <With Var="CmdID"/>
        <With Var="SD"/>
        <With Var="PN"/>
      </Event>
      <Event Comment="Request Service state" Name="REQS" Type="Event"/>
    </EventInputs>
    <EventOutputs>
      <Event Comment="Initialization Confirm" Name="INITO" Type="Event">
        <With Var="QO"/>
      </Event>
      <Event Comment="Execution Confirmation" Name="CNF" Type="Event">
        <With Var="RID"/>
      </Event>
      <Event Comment="Service State Confirmation" Name="CNFS" Type="Event">
        <With Var="ServiceState"/>
      </Event>
    </EventOutputs>
    <InputVars>
      <VarDeclaration Comment="Input event qualifier" Name="QI" Type="BOOL"/>
      <VarDeclaration Comment="Action to be executed ID" Name="CmdID" Type="UINT"/>
      <VarDeclaration Comment="Action parameters" Name="SD" Type="STRING"/>
      <VarDeclaration Comment="Number of parameters" Name="PN" Type="USINT"/>
    </InputVars>
    <OutputVars>
      <VarDeclaration Comment="Output event qualifier" Name="QO" Type="BOOL"/>
      <VarDeclaration Comment="Executed action ID" Name="RID" Type="USINT"/>
      <VarDeclaration Comment="Service feedback data" Name="RD" Type="STRING"/>
      <VarDeclaration Comment="CNC Service state" Name="ServiceState" Type="USINT"/>
    </OutputVars>
  </InterfaceList>
  <FBNetwork>
    <FB Name="L0_SendBlk" Type="L0_SendBlk" x="1710.0" y="1995.0"/>
    <FB Name="L0_CNCEncap" Type="L0_CNCEncap" x="950.0" y="1995.0"/>
    <FB Name="L0_StateHandler" Type="L0_StateHandler" x="4300.0" y="2665.0"/>
    <FB Name="L0_CompletedEx" Type="L0_CompletedEx" x="5320.0" y="2280.0"/>
    <FB Name="CM_Merge2E2USINT" Type="CM_Merge2E2USINT" x="6365.0" y="2280.0"/>
    <FB Name="CM_Merge2E2USINT_0" Type="CM_Merge2E2USINT" x="4370.0" y="190.0">
      <Parameter Name="E1In" Value="3"/>
      <Parameter Name="E2In" Value="4"/>
    </FB>
    <FB Name="CM_Merge2E2USINT_1" Type="CM_Merge2E2USINT" x="5320.0" y="0.0"/>
    <FB Name="L0_ReqManager" Type="L0_ReqManager" x="2755.0" y="-475.0"/>
    <FB Name="CM_Merge2E2USINT_2" Type="CM_Merge2E2USINT" x="5320.0" y="3135.0">
      <Parameter Name="E1In" Value="1"/>
      <Parameter Name="E2In" Value="2"/>
    </FB>
    <FB Name="CM_ChkService" Type="CM_ChkService" x="1425.0" y="0.0"/>
    <FB Name="L0_State_0" Type="L0_State" x="2945.0" y="1235.0"/>
    <DataConnections>
      <Connection Comment="" Destination="L0_CNCEncap.CmdID" Source="CmdID" dx1="255.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_CNCEncap.SD" Source="SD" dx1="175.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_CNCEncap.PN" Source="PN" dx1="0.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_SendBlk.sBlock" Source="L0_CNCEncap.sBlock" dx1="50.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_SendBlk.QI" Source="L0_CNCEncap.QO" dx1="155.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CM_Merge2E2USINT.E1In" Source="L0_CompletedEx.RID" dx1="0.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CM_Merge2E2USINT_1.E2In" Source="CM_Merge2E2USINT_0.Out" dx1="2335.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CM_Merge2E2USINT_1.E1In" Source="L0_ReqManager.RIDOut" dx1="335.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_ReqManager.RIDIn" Source="CM_Merge2E2USINT.Out" dx1="325.0" dx2="0.0" dy="-430.0"/>
      <Connection Comment="" Destination="L0_CNCEncap.QI" Source="QI" dx1="335.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_ReqManager.QI" Source="L0_SendBlk.QO" dx1="180.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="QO" Source="L0_ReqManager.QO" dx1="4255.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CM_Merge2E2USINT.E2In" Source="CM_Merge2E2USINT_2.Out" dx1="290.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="RID" Source="CM_Merge2E2USINT_1.Out" dx1="0.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CM_ChkService.ServiceState" Source="L0_State_0.ServiceState" dx1="345.0" dx2="-240.0" dy="-120.0"/>
      <Connection Comment="" Destination="ServiceState" Source="L0_State_0.ServiceState" dx1="4090.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_StateHandler.CNCState" Source="L0_State_0.StateOut" dx1="165.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_State_0.StateIn" Source="L0_SendBlk.CNCState" dx1="500.0" dx2="0.0" dy="0.0"/>
    </DataConnections>
    <EventConnections>
      <Connection Comment="" Destination="L0_SendBlk.REQ" Source="L0_CNCEncap.CNF" dx1="0.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_SendBlk.INIT" Source="L0_CNCEncap.INITO" dx1="0.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_CompletedEx.OnReady" Source="L0_StateHandler.OnReady" dx1="0.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_CompletedEx.OnExecuting" Source="L0_StateHandler.OnExecution" dx1="150.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_CompletedEx.OnNotReady" Source="L0_StateHandler.OnNotReady" dx1="310.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CM_Merge2E2USINT.E1" Source="L0_CompletedEx.Success" dx1="0.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CM_Merge2E2USINT_1.E1" Source="L0_ReqManager.IND" dx1="1785.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_ReqManager.UPDT" Source="CM_Merge2E2USINT.EO" dx1="30.0" dx2="-190.0" dy="-240.0"/>
      <Connection Comment="" Destination="L0_CNCEncap.INIT" Source="INIT" dx1="435.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_CNCEncap.REQ" Source="L0_ReqManager.CNF" dx1="0.0" dx2="0.0" dy="5.0"/>
      <Connection Comment="" Destination="L0_ReqManager.INIT" Source="L0_SendBlk.INITO" dx1="0.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="INITO" Source="L0_ReqManager.INITO" dx1="3880.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CM_Merge2E2USINT.E2" Source="CM_Merge2E2USINT_2.EO" dx1="130.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CM_Merge2E2USINT_2.E1" Source="L0_StateHandler.OnInterrupted" dx1="320.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CM_Merge2E2USINT_2.E2" Source="L0_StateHandler.OnIntError" dx1="150.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CM_Merge2E2USINT_1.E2" Source="CM_Merge2E2USINT_0.EO" dx1="0.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CNF" Source="CM_Merge2E2USINT_1.EO" dx1="145.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_ReqManager.REQ" Source="CM_ChkService.UP" dx1="300.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CM_Merge2E2USINT_0.E1" Source="CM_ChkService.DOWN" dx1="275.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CM_Merge2E2USINT_0.E2" Source="CM_ChkService.BUSY" dx1="275.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CM_ChkService.REQ" Source="REQ" dx1="0.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_State_0.REQ1" Source="CM_ChkService.REQS" dx1="0.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_State_0.REQ2" Source="REQS" dx1="380.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="CM_ChkService.RSP" Source="L0_State_0.CNF1" dx1="190.0" dx2="-350.0" dy="-5.0"/>
      <Connection Comment="" Destination="CNFS" Source="L0_State_0.CNF2" dx1="3140.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_StateHandler.REQ" Source="L0_State_0.UPDTO" dx1="560.0" dx2="0.0" dy="0.0"/>
      <Connection Comment="" Destination="L0_State_0.UPDT" Source="L0_SendBlk.IND" dx1="330.0" dx2="0.0" dy="0.0"/>
    </EventConnections>
  </FBNetwork>
</FBType>
